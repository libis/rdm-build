LoadModule ssl_module modules/mod_ssl.so

Listen 443 https

ServerName localhost

SSLPassPhraseDialog     exec:/usr/libexec/httpd-ssl-pass-dialog
SSLSessionCache         shmcb:/run/httpd/sslcache(512000)
SSLSessionCacheTimeout  300

SSLRandomSeed   startup file:/dev/urandom  256
SSLRandomSeed   connect builtin
SSLCryptoDevice         builtin

LogFormat "\"%{%F %T %Z}t\" %{X-Forwarded-For}i %u %>s %{proxy-status}n %b \"%r\"" proxy
LogFormat "\"%{%F %T %Z}t\" %{X-Forwarded-For}i %u %>s %{proxy-status}n %b \"%r\" \"%{Referer}i\" \"%{User-Agent}i\"" proxycombined

<VirtualHost *:443>

    ServerAdmin             root@localhost

    LogLevel                warn
    CustomLog               "logs/rdm_access.log" proxycombined
    ErrorLog                "logs/rdm_error.log"
    
    SSLEngine               on
    SSLProtocol             all -SSLv2
    SSLCipherSuite          ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM:+LOW
    SSLCertificateFile      /etc/pki/rdm/ssl.crt
    SSLCertificateKeyFile   /etc/pki/rdm/ssl.key

    # don't pass paths used by rApache and TwoRavens to app server
    ProxyPassMatch          ^/RApacheInfo$ !
    ProxyPassMatch          ^/custom !
    ProxyPassMatch          ^/dataexplore !

    # don't pass paths used by Shibboleth to app server
    ProxyPassMatch          ^/Shibboleth.sso !
    ProxyPassMatch          ^/shibboleth-ds !

    # pass /apidoc to OpenAPI UI
    ProxyPass     /apidoc   http://apidoc:8080/apidoc

    # do not pass /images on
    ProxyPass     /images   "!"

    # pass everything else to app server
    ProxyPass     /         ajp://dataverse:8009/

    <Location /shib.xhtml>
        AuthType                shibboleth
        ShibRequestSetting      requireSession 1
        require                 valid-user
    </Location>

</VirtualHost>
