Listen 81 http

ServerName localhost

LogFormat "\"%{%F %T %Z}t\" %{X-Forwarded-For}i %u %>s %{proxy-status}n %b \"%r\"" proxy
LogFormat "\"%{%F %T %Z}t\" %{X-Forwarded-For}i %u %>s %{proxy-status}n %b \"%r\" \"%{Referer}i\" \"%{User-Agent}i\"" proxycombined

<VirtualHost *:81>

    ServerAdmin             root@localhost

    LogLevel                warn
    CustomLog               "logs/rdm_access.log" proxycombined
    ErrorLog                "logs/rdm_error.log"
    
    # don't pass paths used by rApache and TwoRavens to app server
    ProxyPassMatch          ^/RApacheInfo$ !
    ProxyPassMatch          ^/custom !
    ProxyPassMatch          ^/dataexplore !

    # don't pass paths used by Shibboleth to app server
    ProxyPassMatch          ^/Shibboleth.sso !
    ProxyPassMatch          ^/shibboleth-ds !

    # pass /apidoc to OpenAPI UI
    ProxyPass     /apidoc   http://apidoc:8080/apidoc

    # do not pass /images on
    ProxyPass     /images   "!"

    # pass everything else to app server
    ProxyPass     /         ajp://dataverse:8009/

    <Location /shib.xhtml>
        AuthType                shibboleth
        ShibRequestSetting      requireSession 1
        require                 valid-user
    </Location>

    <Directory /var/www/html>
        Options Indexes FollowSymLinks Multiviews
        AllowOverride All
        Require all granted
    </Directory>

</VirtualHost>
